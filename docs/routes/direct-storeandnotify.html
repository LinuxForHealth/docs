

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Direct Store and Notify &mdash; Linux for Health  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  

  
  
    <link rel="canonical" href="https://linuxforhealth.github.io/docs/routes/direct-storeandnotify.html"/>
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FHIR TO TEXT" href="fhir-to-text.html" />
    <link rel="prev" title="Orthanc DICOM" href="orthanc-post.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: 0x4380B4" >
          

          
            <a href="../index.html" class="icon icon-home"> Linux for Health
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer-setup.html">Developer Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/firstroute.html">Hello World</a></li>
<li class="toctree-l1"><a class="reference internal" href="../application-configuration.html">Application Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../feature-configuration.html">Feature Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../message-structure.html">Message Structure</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/fhir-r4.html">FHIR R4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/hl7-v2.html">HL7-v2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/blue-button-20.html">Blue Button 2.0</a></li>
</ul>
<p class="caption"><span class="caption-text">Routes:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="fhir-r4-rest.html">FHIR R4</a></li>
<li class="toctree-l1"><a class="reference internal" href="etl.html">ETL</a></li>
<li class="toctree-l1"><a class="reference internal" href="orthanc-post.html">Orthanc DICOM</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Direct Store and Notify</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#purpose">Purpose</a></li>
<li class="toctree-l2"><a class="reference internal" href="#details">Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#exchange-state">Exchange State</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#calling-the-route">Calling the Route</a></li>
<li class="toctree-l2"><a class="reference internal" href="#results">Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fhir-to-text.html">FHIR TO TEXT</a></li>
<li class="toctree-l1"><a class="reference internal" href="nlp.html">NLP</a></li>
</ul>
<p class="caption"><span class="caption-text">Develop:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../develop/extend.html">Developing for LinuxForHealth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/build.html">Building Your Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/test.html">Testing Your Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/property-encryption.html">Property Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/route-basics.html">Developing Routes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/configure-kong.html">Configuring Kong</a></li>
</ul>
<p class="caption"><span class="caption-text">Deployment:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../deployment/container.html">Container Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment/compose.html">Docker Compose Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment/openshift.html">OpenShift Container Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment/oci.html">Open Container Initiative (OCI)</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Linux for Health</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Direct Store and Notify</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/routes/direct-storeandnotify.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="direct-store-and-notify">
<h1>Direct Store and Notify<a class="headerlink" href="#direct-store-and-notify" title="Permalink to this headline">¶</a></h1>
<div class="section" id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<p>The LinuxForHealth (LFH) direct:storeAndNotify route allows you to store transaction data as part of the LFH Longitudinal Patient Record (LPR) and notify listeners of the stored data via NATS for downstream integration.</p>
</div>
<div class="section" id="details">
<h2>Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Attribute</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Route Name</p></td>
<td><p>store-and-notify</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>Route URI               | direct:storeAndNotify</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>Supported Operation(s)  | Camel direct invocation</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>The direct:storeAndNotify route expects the following input state in the Camel message Exchange.</p>
<div class="section" id="exchange-state">
<h3>Exchange State<a class="headerlink" href="#exchange-state" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 16%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Element</p></th>
<th class="head" colspan="2"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Message Properties</p></td>
<td colspan="2"><p>LFH message properties are stored as Exchange properties.  Before direct:storeAndNotify is called, these Exchange properties must be set via the LinuxForHealth MetaDataProcessor. This ensures that the message will be stored in the data store using the LFH standard format.</p></td>
</tr>
<tr class="row-odd"><td><p>Message Body</p></td>
<td colspan="2"><p>The message body contains the data to be stored in the data store, e.g. a HL7v2 message or a FHIR R4 resource.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="calling-the-route">
<h2>Calling the Route<a class="headerlink" href="#calling-the-route" title="Permalink to this headline">¶</a></h2>
<p>direct:storeAndNotify is invoked as a part of a route you define, at or near the end of your route, once the incoming message is fully processed.  In this example, the LFH HL7v2 route unmarshals the data, does further processing, then invokes direct:storeAndNotify to store the HL7v2 input message and LFH message properties in the data store:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">protected</span> <span class="n">void</span> <span class="n">buildRoute</span><span class="p">(</span><span class="n">String</span> <span class="n">routePropertyNamespace</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">from</span><span class="p">(</span><span class="s2">&quot;{{lfh.connect.hl7-v2.uri}}&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">routeId</span><span class="p">(</span><span class="n">ROUTE_ID</span><span class="p">)</span>
            <span class="o">.</span><span class="n">unmarshal</span><span class="p">()</span><span class="o">.</span><span class="n">hl7</span><span class="p">()</span>
            <span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">new</span> <span class="n">MetaDataProcessor</span><span class="p">(</span><span class="n">routePropertyNamespace</span><span class="p">))</span>
            <span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">LinuxForHealthRouteBuilder</span><span class="o">.</span><span class="n">STORE_AND_NOTIFY_CONSUMER_URI</span><span class="p">)</span>
            <span class="o">.</span><span class="n">id</span><span class="p">(</span><span class="n">ROUTE_PRODUCER_ID</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h2>
<p>As a result of calling this direct:storeAndNotify route, the message body and LFH message attributes are stored in Kafka and a message indicating the location in Kafka is sent via NATS to subscribers.  The data in Kafka is viewable via the <a class="reference external" href="http://localhost:9000/">Kafdrop viewer</a> at the topic, partition and offset shown in the LinuxForHealth JSON message you receive upon submitting the FHIR resource.</p>
</div>
<div class="section" id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="../message-structure.html">LinuxForHealth Message Structure</a></p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="fhir-to-text.html" class="btn btn-neutral float-right" title="FHIR TO TEXT" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="orthanc-post.html" class="btn btn-neutral float-left" title="Orthanc DICOM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright .

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
 
<div class="footer">
    <p>
        LinuxForHealth is sublicensed by the Linux Foundation with Sublicense ID: 20200615-0008
    </p>
</div>    


</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>